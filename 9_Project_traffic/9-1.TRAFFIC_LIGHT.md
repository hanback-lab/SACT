# Traffic Light Control
---

## 기획

이 절에서는 그동안 실습하였던 GATE에 대한 동작 내용을 응용하여 신호등 제어하는 예제를 진행하려고 한다. 


<img src="./pds/tra01.png" alt="tra01" style="width: 35%;"><br>

<BR>

장비에 응용 회로를 제어하도록 신호등이 구성되어 있다. 

국내에서 주로 보이는 네거리 신호등의 형식이다. 

<img src="./pds/tra02.png" alt="traffic" style="width: 70%;"><br>


동작에 대한 사항은 다음과 같다. 


1. 신호등은 네거리에 있는 차도의 신호등과 횡단보도의 신호등으로 서로 연계되어 제어된다. 

2. 네거리의 차도와 횡단보도의 신호등은 위치에 따라 NORTH/EAST/SOUTH/WEST로 구별한다. 

3. 차도를 기준으로 신호등은 NORTH -> EAST -> SOUTH -> WEST -> NORTH의 시계 방향으로 상태가 회전하며 제어된다. 

횡단보도를 기준으로는 EAST -> SOUTH -> WEST -> NORTH -> EAST의 시계 방향으로 상태가 회전하여 제어된다. 

<img src="./pds/tra06.png" alt="traffic" style="width: 80%;"><br>

|순서| 차도 방향 | 횡단보도 방향 |
|:-:|:-:|:-:|
|1|NORTH|EAST|
|2|EAST|SOUTH|
|3|SOUTH|WEST|
|4|WEST|NORTH|
|5|NORTH|EAST|
|...|...|...|

<BR>

4. 각 상태의 변화는 10초를 기준으로 이루어진다. 

5. 각 차도의 신호등은 RED/YELLOW/LEFT/GREEN의 4개 신호가 제어된다. 

    <img src="./pds/tra03.png" alt="traffic" style="width: 70%;"><br>
    |RED|YELLOW|LEFT|GREEN|
    |-|-|-|-|

6. 각 횡단보도의 신호등은 GREEN/RED의 2개의 신호가 제어되며, 각 방향의 양쪽에 있는 횡단보도의 신호등이 동시에 제어된다. 

   <img src="./pds/tra03a.png" alt="traffic" style="width: 25%;"><br>
    |GREEN|RED|
    |-|-|

7. 차도의 기준에서 상태가 변하는 10초의 기준을 두고 다음과 같이 움직인다. 

    RED는 상태가 현재의 방향이 아닐 때 ON된다. 

   |SEC|RED|YELLOW|LEFT|GREEN|
   |:-:|:-:|:-:|:-:|:-:|
   |0|OFF|OFF|ON|ON|
   |1|OFF|OFF|ON|ON|
   |2|OFF|OFF|ON|ON|
   |3|OFF|OFF|ON|ON|
   |4|OFF|OFF|ON|ON|
   |5|OFF|OFF|ON|ON|
   |6|OFF|ON|OFF|OFF|
   |7|OFF|ON|OFF|OFF|
   |8|OFF|ON|OFF|OFF|
   |9|OFF|ON|OFF|OFF|

7. 횡단보도의 기준에서 상태가 변하는 10초의 기준을 두고 다음과 같이 움직인다. 

    RED는 상태가 현재의 방향이 아닐 때 ON된다. 

   |SEC|RED|GREEN|
   |:-:|:-:|:-:|
   |0|OFF|ON|
   |1|OFF|ON|
   |2|OFF|ON|
   |3|OFF|ON|
   |4|OFF|ON|
   |5|OFF|ON|
   |6|OFF|Flashing|
   |7|OFF|Flashing|
   |8|OFF|Flashing|
   |9|OFF|Flashing|


<BR>

---
## 하드웨어 정의

신호등을 제어하기 위해서 아래 그림과 같이 구별하여 정의한다. 


<img src="./pds/tra05.png" alt="traffic" style="width: 70%;"><br>


CROSS는 차도의 신호등을 의미하고, WALK는 인도의 신호등을 의미한다. . 

|1|2|3|4|
|:-:|:-:|:-:|:-:|
|NORTH_CROSS|EAST_CROSS|SOUTH_CROSS|WEST_CROSS|
|5|6|7|8|
|NORTH_WALK|EAST_WALK|SOUTH_WALK|WEST_WALK|


차도의 신호등은 아래와 같이 4개의 신호등으로 구성되어 있다. 

<img src="./pds/tra03.png" alt="traffic" style="width: 70%;"><br>

|RED|YELLOW|LEFT|GREEN|
|-|-|-|-|

인도의 신호등은 아래와 같이 2개의 신호등으로 구성되어 있다. 

<img src="./pds/tra03a.png" alt="traffic" style="width: 25%;"><br>
|GREEN|RED|
|-|-|

<BR>

신호등의 각 위치 및 차도의 신호등일 때의 역할과 횡단보도의 신호등일 때의 역할에 따라 아래 표와 같이 이름을 정의한다. 

|그림에서의 위치|DESCRIPTION|PORT NAME|
|:-:|:-:|:-:|
|1|NORTH CROSS GREEN  |N_C_G|
|1|NORTH CROSS LEFT   |N_C_L|
|1|NORTH CROSS YELLOW |N_C_G|
|1|NORTH CROSS RED    |N_C_G|
|2|EAST CROSS GREEN   |E_C_G|
|2|EAST CROSS LEFT    |E_C_L|
|2|EAST CROSS YELLOW  |E_C_G|
|2|EAST CROSS RED     |E_C_G|
|3|SOUTH CROSS GREEN  |S_C_G|
|3|SOUTH CROSS LEFT   |S_C_L|
|3|SOUTH CROSS YELLOW |S_C_G|
|3|SOUTH CROSS RED    |S_C_G|
|4|WEST CROSS GREEN   |W_C_G|
|4|WEST CROSS LEFT    |W_C_L|
|4|WEST CROSS YELLOW  |W_C_G|
|4|WEST CROSS RED     |W_C_G|
|5|NORTH WALK GREEN   |N_W_G|
|5|NORTH WALK RED     |N_W_G|
|6|EAST WALK GREEN    |E_W_G|
|6|EAST WALK RED      |E_W_G|
|7|SOUTH WALK GREEN   |S_W_G|
|7|SOUTH WALK RED     |S_W_G|
|8|WEST WALK GREEN    |W_W_G|
|8|WEST WALK RED      |W_W_G|

<BR>

장비에서 위의 포트들을 제어하기 위해서는 해당 핀을 설정해 주어야 하는데, 아래 표와 같이 각 포트에 대한 핀을 정의한다. 

하드웨어로 구성되어 있기 때문에 아래의 핀 번호와 다르면 이상 동작이 일어 날 수 있다. 

<BR>

|DESCRIPTION|PORT NAME|PIN NUMBER|
|:-:|:-:|:-:|
|NORTH CROSS GREEN  |N_C_G|PIN_W22|
|NORTH CROSS LEFT   |N_C_L|PIN_V22|
|NORTH CROSS YELLOW |N_C_G|PIN_Y21|
|NORTH CROSS RED    |N_C_G|PIN_W19|
|EAST CROSS GREEN   |E_C_G|PIN_T16|
|EAST CROSS LEFT    |E_C_L|PIN_V16|
|EAST CROSS YELLOW  |E_C_G|PIN_AB16|
|EAST CROSS RED     |E_C_G|PIN_W17|
|SOUTH CROSS GREEN  |S_C_G|PIN_AB18|
|SOUTH CROSS LEFT   |S_C_L|PIN_AB19|
|SOUTH CROSS YELLOW |S_C_G|PIN_AB20|
|SOUTH CROSS RED    |S_C_G|PIN_AA22|
|WEST CROSS GREEN   |W_C_G|PIN_AA18|
|WEST CROSS LEFT    |W_C_L|PIN_AA19|
|WEST CROSS YELLOW  |W_C_G|PIN_AA20|
|WEST CROSS RED     |W_C_G|PIN_AA21|
|NORTH WALK GREEN   |N_W_G|PIN_V21|
|NORTH WALK RED     |N_W_G|PIN_W21|
|EAST WALK GREEN    |E_W_G|PIN_Y17|
|EAST WALK RED      |E_W_G|PIN_U17|
|SOUTH WALK GREEN   |S_W_G|PIN_AA16|
|SOUTH WALK RED     |S_W_G|PIN_U16|
|WEST WALK GREEN    |W_W_G|PIN_W20|
|WEST WALK RED      |W_W_G|PIN_Y22|







